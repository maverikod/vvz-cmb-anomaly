# ЗАДАНИЕ: Автоматический поиск аномалий с вариацией радиуса на карте CMB

**Входные данные:**
- Карта температуры космического микроволнового фона (`COM_CMB_IQU-smica_2048_R3.00_full.fits`, слой I)
- Маска для исключения загрязнённых областей (`COM_Mask_CMB-common-Mask-Int_2048_R3.00.fits`)

**Цель:**  
Найти и статистически охарактеризовать аномальные области (hot/cold spots) разного размера на карте, чтобы выявить устойчивые крупномасштабные структуры и исследовать их характерные масштабы.

---

## Алгоритм:

1. **Применить маску к карте**, исключив все загрязнённые и неинтересные области.
2. **Для каждой выбранной точки на небе** (например, на сетке с шагом X градусов):
    - Для радиусов R в диапазоне от R_min до R_max (например, от 1° до 15° с шагом 1°):
        1. Определить круговую область (ROI) радиуса R вокруг данной точки.
        2. Рассчитать среднее значение температуры в этой области.
        3. Рассчитать стандартное отклонение (σ) температуры для этой области.
        4. Вычислить “меру аномальности” — например, 
           \[
           S = \frac{|\langle T_\text{ROI} \rangle - \langle T_\text{sky} \rangle|}{\sigma_\text{sky}}
           \]
           где ⟨T⟩ — средняя температура в ROI и по небу, σ — стандартное отклонение по небу (вне маски).
        5. Сохранить тройку (центр, радиус, S) в общий список.
3. **По завершении:**  
    - Для каждой точки построить график S(r) — как мера аномальности меняется с радиусом.
    - Найти максимальные значения S и соответствующие им радиусы для каждой точки (т.е. где аномалия выражена сильнее всего).
    - Построить карту наиболее аномальных областей и распределение их характерных размеров.
4. **Провести сравнительный анализ:**  
    - Сравнить найденные размеры аномалий с общим размером “кластера” (например, области без маски или ROI большого масштаба).
    - Оценить, есть ли устойчивые аномалии, размер которых составляет определённую долю от размера кластера (например, 0.1–0.3 или другие характерные значения).
5. **Оформить результат:**  
    - Таблица с координатами, радиусами и “аномальностью” для top-N областей.
    - Визуализация карты с нанесёнными крупными аномалиями и их размерами.
    - График зависимости “анормальности” от радиуса для нескольких примеров (например, для cold spot).

---

## Особые требования:

- Автоматизация: процесс должен запускаться без ручной подгонки радиуса — перебор диапазона обязателен.
- Оптимизация: допускается пропускать точки, если они целиком попадают в маску.
- Сравнение: результаты должны быть сопоставимы для разных диапазонов радиуса.
- Отчёт: оформить краткие выводы о распределении размеров аномалий и их “устойчивости” при изменении радиуса.

---

## Примечания:
- Можно использовать любую удобную метрику “аномальности” (среднее, σ, p-value и др.) — но формулу явно указать.
- Желательно не ограничивать анализ только “cold” или только “hot” spot — анализировать оба случая.
- Для скорости можно ограничить шаг по координатам и радиусу, чтобы не сканировать всю карту с субградусным разрешением.

